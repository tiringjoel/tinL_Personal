%-------------------------
%big-picture
%(c) H.Buchmann FHNW 2008
%$Id$
%export TEXINPUTS=${HOME}/fhnw/edu/:${HOME}/fhnw/edu/tinL/config/latex:${HOME}/fhnw/edu/config//:
%-------------------------
\documentclass{beamer}
\usepackage{latex/beamer}
\input{defines.tex}
\input{/home/buchmann/latex/dirtree/dirtree.tex}

\title[Netzwerk]{Netzwerk}
\begin{document}

\frame{\titlepage}

\begin{frame}{Ziel}{\target am Schulnetz}
 \begin{itemize}
  \item verschiedenen Netze
  
  \hspace{5mm}
  
  \begin{tabular}{r|c|c|c}
       & public & vpn & eduroam\\
\hline       
   LAN &  x     &  x  & \\
   WLAN&  x     &  x  & x  
  \end{tabular}
  \item Sicherheit 
  \begin{itemize}
   \item keine sichtbaren Passworte
  \end{itemize}
 \end{itemize}
\end{frame}

\begin{frame}{Wichtig}{Wichtig}
 \begin{itemize}
  \item {\Huge richtiges} Passwort auf \target
  \item \cod{passwd}
 \end{itemize}
\end{frame}

\begin{frame}{Probleme}{Konfiguration mit restriktivem Netzzugriff}
  \begin{tabular}{r|c|c|c}
       & public & vpn & eduroam\\
\hline       
   LAN &  {\em local} & {\em full}  & \\
   WLAN&  {\em local} & {\em full}  & {\em full}
  \end{tabular}
\vspace{5mm}  
\begin{description}[local]
 \item[local] Zugriff nur im lokalen Netz
 \item[full] voller Zugriff nach Konfiguration
\end{description}  
\end{frame}

\begin{frame}{Was haben wir ?}{Verbindung zum \target}
 \begin{description}[RS232 online]
  \item[\host offline] \cod{mount} SD-Card 
  \item[RS232 online] wichtige Verbindung
 \end{description}
\end{frame}

\begin{frame}{Die Schritte}{Bootstrapping}
 \begin{itemize}
  \item Ethernet Verbindung \host - \target 
  \item \target Installation der notwendigen {\em packages}
  \begin{itemize}
   \item vom Internet mit \host als gateway
  \end{itemize}
 \end{itemize}
\end{frame}

\begin{frame}{\cod{ssh} \& Co}
 \begin{itemize}
   \item die Stärken von \unix \cod{ssh} nutzen
   \begin{itemize}
    \item \cod{glbs/8-ssh/doc/ssh.pdf}
   \end{itemize}
 \end{itemize}
\end{frame}

\begin{frame}{Die Schritte}
 \begin{itemize}
  \item LAN \target \host
  \begin{description}
   \item[\cod{ssh}]  für die Verbindung
   \item[\cod{sshfs}] für die einfache Konfiguration Files editieren
  \end{description}
  \item WLAN public
  \item WLAN vpn
  \item WLAN eduroam
 \end{itemize}
\end{frame}

\begin{frame}{LAN}{\host \target}
 \begin{description}[\target]
  \item[\host] \cod{eth0} Schnittstelle
   \begin{itemize}
    \item \cod{ifconfig eth0 192.168.1.1 up}
   \end{itemize}
   \item[\target] \cod{eth0} Schnittstelle
   \begin{itemize}
    \item \cod{ifconfig eth0 192.168.1.2 up}
   \end{itemize}
   \item[test] mit \cod{ping}
 \end{description}
\end{frame}

\begin{frame}{\cod{ssh}/\cod{sshfs}}{\target}
\begin{description}
 \item[ssh] \cod{ssh user@ip}
 \begin{itemize}
  \item ohne Passwort $\to$ \cod{ssh-copy-id} 
 \end{itemize}
 \item[sshfs] \cod{sshfs user@ip:dir dir} 
\end{description}
\end{frame}

\begin{frame}[fragile]{\cod{pacman}}{Der {\em packetmanager}}
 \begin{itemize}
  \item Die Files
  \begin{itemize}
   \item \cod{/etc/pacman.conf}
   \begin{lstlisting}
...
#XferCommand = /usr/bin/curl -C - -f %u > %o
#XferCommand = /usr/bin/wget --passive-ftp -c -O %o %u
..
   \end{lstlisting}
   \item \cod{/etc/pacman.d/mirrorlist}
  \end{itemize}
 \end{itemize}
\end{frame}

\begin{frame}{\cod{wget}}{für das Internet}
 \begin{description}[\target]
  \item[\host] Probieren
  \begin{itemize}
   \item \cod{wget} 
  \end{itemize}
  \item[\target] Mit \cod{ssh} Tunnel
  \begin{itemize}
   \item \cod{ssh user@host 'wget ...' {\Huge >} file} 
   \begin{description}
    \item[\cod{\Huge >}] redirect
   \end{description}
  \end{itemize}
 \end{description}
\end{frame}

\begin{frame}{\target \cod{ssh} Tunnel}{Alles ist ein File}
 \begin{itemize}
  \item \cod{ssh \host cmd} \cod{cmd} auf dem host ausführen
  \item \cod{stdout} von \cod{cmd} auf \target
 \end{itemize}
\end{frame}

\begin{frame}[fragile]{Bootstrap}
 \begin{description}[\target]
  \item[\host]   \cod{sshfs} \target \host
  \item[\host]   \target \cod{/etc/pacman.conf} editieren
  \item[\target] \cod{pacman -Suy} 
 \end{description}
\begin{lstlisting}
#XferCommand = /usr/bin/curl -C - -f %u > %o
#XferCommand = /usr/bin/wget --no-check-certificate --passive-ftp -c -O %o %u
XferCommand = ssh user@ip 'wget -O - -c %u' > %o
\end{lstlisting}
\end{frame}

\begin{frame}{ip forwarding}{provisorisch}
 \begin{itemize}
  \item {\footnotesize \url{https://wiki.archlinux.org/index.php/Internet_sharing}}
  \item Testen ob das {\em forwarding} wirklich funktioniert
 \end{itemize}
\end{frame}


\section{WLAN}
\begin{frame}{Die Probleme}
 \begin{itemize}
  \item die Administration ist nicht ganz einfach
  \item es gibt verschiedene {\em tool}s:
  \begin{itemize}
   \item \cod{netctl} 
   \item \cod{wicd}
   \item \cod{NetworkManager}
   \item ...
  \end{itemize}
  \item verschiedene Verfahren für eine sichere Verbindung
  \begin{itemize}
   \item IEEE 802.11i
  \end{itemize}
 \end{itemize}
 \begin{remarks}
   \item es sollte nur ein {\em tool} laufen
   \item die {\em tools} verwalten LAN und WLAN
 \end{remarks}
\end{frame}

\begin{frame}{geschichtete Software}{vereinfachtes Bild}
 
 \begin{tabular}{l|l}
  administration & \cod{netctl} \& Co.\\
  \hline
  WLAN Konfiguration & \cod{wpa\_supplicant}\\
  \hline
  \multicolumn{2}{c}{Hardware}
 \end{tabular}
\end{frame}

\begin{frame}{\cod{wpa\_supplicant}}{der WLAN der Bittsteller}
 \begin{itemize}
  \item zwei Komponenten
  \begin{description}
   \item[Prozess] \cod{wpa\_supplicant {\em options}}
   \begin{itemize}
    \item Konfiguration typ. 
   \end{itemize}
   \item[Bedienung] \cod{wpa\_cli} \footnote{\cod{cli} command line interface}
  \end{description}
 \end{itemize}
\end{frame}

\subsection{VPN}
\begin{frame}[fragile]{VPN}{Konfiguration}
\begin{verbatim}
IPSec gateway vpn.fhnw.ch
IPSec secret  29HeiowA
IPSec ID STU-03-001
IKE Authmode psk
Xauth username kkkkk
Xauth obfuscated password iii
\end{verbatim}
\end{frame}

\begin{frame}{Die Sache mit \cod{obfuscated}}{Vernebeln}
 \begin{itemize}
  \item das Programm \cod{obfuscate.c}
  \item das Programm \cod{cisco-decrypt}
 \end{itemize}
\end{frame}

\section{WLAN/LAN Konfiguration}
\subsection{LAN \cod{ssh}}
\begin{frame}{\cod{ssh}}{\cod{ssh} mount}
 \begin{itemize}
  \item \cod{ssh} ohne Passwort \cod{ssh-copy-id}
  \begin{itemize}
   \item Kopiere {\Huge public key} vom \host auf \target
  \end{itemize}
  \item \cod{sshfs} 
  \begin{itemize} 
   \item {\em target-root} auf \host sichtbar
   \item \cod{fusermount -u} für {\em unmount}
  \end{itemize}
 \end{itemize}
\end{frame}

\begin{frame}[fragile]{\cod{ssh}}{Vorbereitungen \target}
 \begin{itemize}
  \item Setze Datum/Zeit \cod{date} 
  \begin{itemize}
   \item Gewisse Zertifikate schauen auf das Datum
  \end{itemize}
  \item Konfiguriere \cod{/etc/pacman.conf} für \cod{ssh} Tunnel:
   \begin{lstlisting}
   XferCommand = ssh user@ip 'wget -O - -c %u' > %o
   \end{lstlisting}
   \vspace{-2mm}
   \begin{itemize}
    \item via \host 
   \end{itemize}
   \item update 
   \begin{itemize}
    \item \cod{pacman -Suy}
   \end{itemize}
   \item vpnc package
   \begin{itemize}
    \item \cod{package -Su vpnc}
   \end{itemize}
 \end{itemize}
\end{frame}

\subsection{wpa\_supplicant}

\begin{frame}{Prozess/CLI}
 \begin{itemize}
  \item Prozess \cod{wpa\_supplicant {\em options}}
  \item CLI \cod{wpa\_cli}
  \begin{itemize}
   \item wie funktioniert das \cod{cli}
  \end{itemize}
  \item WLAN \cod{fhnw-public}
  \begin{itemize}
   \item \cod{dhcpcd} für eine \cod{ip} Adresse 
  \end{itemize}
  \item Konfigurationsfile
  \item VPN
  \begin{itemize}
   \item mit \cod{vpnc}
  \end{itemize}
  \item eduroam
  \begin{itemize}
   \item mit s\cod{wpa\_supplicant}
  \end{itemize}
 \end{itemize}
\end{frame}

\begin{frame}{Nützliche Files und Adressen}
 \begin{tabular}{ll}
  \cod{host-success.txt}	& log für eduroam\\
  \cod{wpa*}	& Konfiguration \\
  \url{https://cat.eduroam.org} & Konfiguration\footnote{Wo ist die FHNW ?}\\
  \url{https://cat-test.eduroam.org} & sollte gehen
 \end{tabular}
\end{frame}
\end{document}

